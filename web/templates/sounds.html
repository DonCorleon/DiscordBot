{% extends "base.html" %}

{% block title %}Sound Management{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üîä Sound Management</h1>
    <p>Manage soundboard files and metadata</p>
</div>

<div class="sounds-controls">
    <div class="control-group">
        <select id="guild-filter" class="filter-select">
            <option value="">All Guilds</option>
        </select>

        <input
            type="text"
            id="sound-search"
            placeholder="Search sounds..."
            autocomplete="off"
        >
    </div>

    <button id="upload-btn" class="btn-primary">
        üì§ Upload New Sound
    </button>
</div>

<div class="sounds-stats">
    <div class="stat-item">
        <span class="stat-label">Total:</span>
        <span id="total-sounds">0</span>
    </div>
    <div class="stat-item">
        <span class="stat-label">Size:</span>
        <span id="total-size">0 B</span>
    </div>
</div>

<div id="sounds-grid" class="sounds-grid">
    <div class="sounds-loading">Loading sounds...</div>
</div>

<!-- Edit Sound Modal -->
<div id="edit-modal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2>Edit Sound</h2>
            <button class="modal-close" onclick="closeEditModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="edit-form">
                <input type="hidden" id="edit-sound-id">

                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="edit-title" required>
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea id="edit-description" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label>Trigger Words (comma-separated)</label>
                    <input type="text" id="edit-triggers" placeholder="word1, word2, word3">
                    <small>Words that will trigger this sound in voice chat</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Volume (0.0 - 2.0)</label>
                        <input type="number" id="edit-volume" min="0" max="2" step="0.1" required>
                    </div>

                    <div class="form-group">
                        <label>Cooldown (seconds)</label>
                        <input type="number" id="edit-cooldown" min="0" step="1">
                    </div>
                </div>

                <div class="form-group">
                    <label>Guild</label>
                    <select id="edit-guild">
                        <option value="default_guild">Global</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="edit-disabled">
                        Disabled (sound won't play)
                    </label>
                </div>

                <div class="sound-info">
                    <div><strong>Filename:</strong> <span id="edit-filename"></span></div>
                    <div><strong>Size:</strong> <span id="edit-size"></span></div>
                    <div><strong>Play Count:</strong> <span id="edit-playcount"></span></div>
                    <div><strong>Added By:</strong> <span id="edit-addedby"></span></div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-danger" onclick="deleteSoundFromModal()">
                üóëÔ∏è Delete Sound
            </button>
            <button type="button" class="btn-secondary" onclick="closeEditModal()">
                Cancel
            </button>
            <button type="button" class="btn-primary" onclick="saveSound()">
                üíæ Save Changes
            </button>
        </div>
    </div>
</div>

<!-- Upload Modal -->
<div id="upload-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Upload New Sound</h2>
            <button class="modal-close" onclick="closeUploadModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="upload-form">
                <div class="form-group">
                    <label>Audio File *</label>
                    <input type="file" id="upload-file" accept=".mp3,.wav,.ogg,.m4a,.flac" required>
                    <small>Supported: MP3, WAV, OGG, M4A, FLAC</small>
                </div>

                <div class="form-group">
                    <label>Title *</label>
                    <input type="text" id="upload-title" required>
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea id="upload-description" rows="2"></textarea>
                </div>

                <div class="form-group">
                    <label>Trigger Words (comma-separated)</label>
                    <input type="text" id="upload-triggers" placeholder="word1, word2">
                </div>

                <div class="form-group">
                    <label>Guild</label>
                    <select id="upload-guild">
                        <option value="default_guild">Global</option>
                    </select>
                </div>
            </form>
            <div id="upload-progress" class="upload-progress" style="display: none;">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <p id="upload-status">Uploading...</p>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-secondary" onclick="closeUploadModal()">
                Cancel
            </button>
            <button type="button" class="btn-primary" onclick="submitUpload()">
                üì§ Upload
            </button>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-modal" class="modal">
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h2>Confirm Delete</h2>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete <strong id="delete-sound-title"></strong>?</p>
            <p class="warning-text">This will permanently delete the sound file and cannot be undone.</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-secondary" onclick="closeDeleteModal()">
                Cancel
            </button>
            <button type="button" class="btn-danger" onclick="confirmDelete()">
                üóëÔ∏è Delete
            </button>
        </div>
    </div>
</div>

<style>
.sounds-controls {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    justify-content: space-between;
    align-items: center;
}

.control-group {
    display: flex;
    gap: 1rem;
    flex: 1;
}

.filter-select {
    padding: 0.75rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 0.95rem;
    min-width: 200px;
}

#sound-search {
    flex: 1;
    padding: 0.75rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 0.95rem;
}

.btn-primary {
    padding: 0.75rem 1.5rem;
    background: linear-gradient(135deg, #5865F2 0%, #4752C4 100%);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    white-space: nowrap;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(88, 101, 242, 0.4);
}

.sounds-stats {
    display: flex;
    gap: 2rem;
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: var(--bg-secondary);
    border-radius: 8px;
}

.stat-item {
    display: flex;
    gap: 0.5rem;
}

.stat-label {
    color: var(--text-secondary);
    font-weight: 500;
}

.sounds-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
}

.sounds-loading {
    grid-column: 1 / -1;
    text-align: center;
    padding: 3rem;
    color: var(--text-secondary);
}

.sound-card {
    background: var(--bg-secondary);
    border-radius: 12px;
    padding: 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.sound-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    border-color: #5865F2;
}

.sound-card.disabled {
    opacity: 0.5;
}

.sound-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 0.75rem;
}

.sound-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
}

.sound-guild {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    background: rgba(88, 101, 242, 0.2);
    color: #5865F2;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 500;
}

.sound-description {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 1rem;
    line-height: 1.4;
}

.sound-triggers {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.trigger-tag {
    padding: 0.25rem 0.5rem;
    background: var(--bg-tertiary);
    border-radius: 4px;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.sound-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1rem;
    border-top: 1px solid var(--border-color);
    font-size: 0.85rem;
}

.meta-item {
    color: var(--text-secondary);
}

.meta-value {
    color: var(--text-primary);
    font-weight: 500;
}

.sound-play-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 40px;
    height: 40px;
    background: rgba(67, 181, 129, 0.2);
    border: 2px solid #43B581;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.sound-play-btn:hover {
    background: #43B581;
    transform: scale(1.1);
}

.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    align-items: center;
    justify-content: center;
}

.modal.show {
    display: flex;
}

.modal-content {
    background: var(--bg-secondary);
    border-radius: 12px;
    max-width: 600px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-large {
    max-width: 800px;
}

.modal-small {
    max-width: 400px;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
}

.modal-header h2 {
    margin: 0;
    color: var(--text-primary);
}

.modal-close {
    background: none;
    border: none;
    font-size: 2rem;
    color: var(--text-secondary);
    cursor: pointer;
    line-height: 1;
}

.modal-body {
    padding: 1.5rem;
}

.modal-footer {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    padding: 1.5rem;
    border-top: 1px solid var(--border-color);
}

.form-group {
    margin-bottom: 1.25rem;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
    font-weight: 500;
}

.form-group input[type="text"],
.form-group input[type="number"],
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 0.75rem;
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    color: var(--text-primary);
    font-size: 0.95rem;
}

.form-group input[type="file"] {
    width: 100%;
    padding: 0.5rem;
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    color: var(--text-primary);
}

.form-group small {
    display: block;
    margin-top: 0.25rem;
    color: var(--text-secondary);
    font-size: 0.85rem;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
}

.checkbox-label input[type="checkbox"] {
    width: auto;
}

.sound-info {
    margin-top: 1.5rem;
    padding: 1rem;
    background: var(--bg-tertiary);
    border-radius: 6px;
    font-size: 0.9rem;
}

.sound-info div {
    margin-bottom: 0.5rem;
}

.warning-text {
    color: #F04747;
    font-weight: 500;
    margin-top: 1rem;
}

.btn-secondary {
    padding: 0.75rem 1.5rem;
    background: var(--bg-tertiary);
    color: var(--text-primary);
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
}

.btn-secondary:hover {
    background: var(--border-color);
}

.btn-danger {
    padding: 0.75rem 1.5rem;
    background: #F04747;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
}

.btn-danger:hover {
    background: #D84040;
}

.upload-progress {
    margin-top: 1rem;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: var(--bg-tertiary);
    border-radius: 4px;
    overflow: hidden;
    margin: 1rem 0;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #43B581 0%, #3CA374 100%);
    width: 0%;
    transition: width 0.3s ease;
}

#upload-status {
    color: var(--text-secondary);
    text-align: center;
}
</style>

<script src="/static/js/sounds.js"></script>
{% endblock %}
